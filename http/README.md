 # HTTP

## Содержание
1. [Основы протокола](#основы-протокола)
2. [Методы HTTP](#методы-http)
3. [REST API](#rest-api)
4. [Коды состояния](#коды-состояния)
5. [Заголовки](#заголовки)
6. [Безопасность](#безопасность)
7. [Оптимизация](#оптимизация)
8. [Вопросы для интервью](#вопросы-для-интервью)

## Основы протокола

### Структура запроса
```
GET /index.html HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0
Accept: text/html
```

### Структура ответа
```
HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 1234

<!DOCTYPE html>
...
```

## Методы HTTP

### GET
- Получение ресурса
- Идемпотентный
- Кэшируемый
- Не имеет тела запроса

### POST
- Создание ресурса
- Не идемпотентный
- Имеет тело запроса
- Не кэшируемый

### PUT
- Обновление ресурса
- Идемпотентный
- Имеет тело запроса

### DELETE
- Удаление ресурса
- Идемпотентный
- Не имеет тела запроса

### PATCH
- Частичное обновление
- Не идемпотентный
- Имеет тело запроса

## REST API

### Принципы REST
1. **Stateless**: сервер не хранит состояние клиента
2. **Единообразие интерфейса**:
   - Ресурсы идентифицируются URI
   - Использование стандартных методов HTTP
   - Представление ресурсов
   - Гипермедиа как движок состояния приложения
3. **Кэширование**
4. **Многоуровневая система**
5. **Код по требованию**

### Пример RESTful API
```javascript
// Получение списка пользователей
GET /api/users

// Получение конкретного пользователя
GET /api/users/1

// Создание пользователя
POST /api/users
{
    "name": "John",
    "email": "john@example.com"
}

// Обновление пользователя
PUT /api/users/1
{
    "name": "John Doe"
}

// Удаление пользователя
DELETE /api/users/1
```

## Коды состояния

### 2xx - Успех
- 200 OK
- 201 Created
- 204 No Content

### 3xx - Перенаправление
- 301 Moved Permanently
- 302 Found
- 304 Not Modified

### 4xx - Ошибка клиента
- 400 Bad Request
- 401 Unauthorized
- 403 Forbidden
- 404 Not Found
- 429 Too Many Requests

### 5xx - Ошибка сервера
- 500 Internal Server Error
- 502 Bad Gateway
- 503 Service Unavailable

## Заголовки

### Общие заголовки
```
Cache-Control: no-cache
Connection: keep-alive
Date: Wed, 21 Oct 2015 07:28:00 GMT
```

### Заголовки запроса
```
Accept: text/html
Accept-Encoding: gzip, deflate
Authorization: Bearer token
User-Agent: Mozilla/5.0
```

### Заголовки ответа
```
Content-Type: application/json
Content-Length: 1234
Set-Cookie: session=abc123
```

## Безопасность

### HTTPS
- Шифрование данных
- Аутентификация сервера
- Защита от MITM-атак

### CORS
```javascript
// Настройка CORS в Express
const cors = require('cors');

app.use(cors({
    origin: 'https://example.com',
    methods: ['GET', 'POST'],
    allowedHeaders: ['Content-Type', 'Authorization']
}));
```

### JWT
```javascript
// Создание токена
const jwt = require('jsonwebtoken');
const token = jwt.sign({ userId: 1 }, 'secret', { expiresIn: '1h' });

// Верификация
jwt.verify(token, 'secret', (err, decoded) => {
    if (err) throw err;
    console.log(decoded);
});
```

## Оптимизация

### Кэширование
```javascript
// Настройка кэширования в Express
const cache = require('express-cache-headers');

app.use(cache({
    maxAge: 3600 // 1 час
}));
```

### Сжатие
```javascript
const compression = require('compression');
app.use(compression());
```

### HTTP/2
- Мультиплексирование
- Сжатие заголовков
- Server Push
- Приоритизация запросов

### Оптимизация изображений
```javascript
// Использование WebP
app.use(express.static('public', {
    setHeaders: (res, path) => {
        if (path.endsWith('.webp')) {
            res.setHeader('Content-Type', 'image/webp');
        }
    }
}));
```

## Вопросы для интервью

### TCP vs UDP

#### TCP (Transmission Control Protocol)
- **Ориентирован на соединение**: устанавливает соединение перед передачей данных
- **Надежная доставка**: гарантирует доставку пакетов в правильном порядке
- **Контроль потока**: предотвращает перегрузку сети
- **Контроль ошибок**: обнаруживает и исправляет ошибки
- **Примеры использования**: HTTP, HTTPS, FTP, SMTP, SSH

#### UDP (User Datagram Protocol)
- **Без установления соединения**: отправляет данные без предварительного соединения
- **Ненадежная доставка**: не гарантирует доставку или порядок пакетов
- **Нет контроля потока**: может перегрузить сеть
- **Минимальный контроль ошибок**: только базовая проверка целостности
- **Примеры использования**: DNS, DHCP, видеостриминг, онлайн-игры, VoIP

#### Когда использовать
- **TCP**: когда важна надежность и порядок данных
- **UDP**: когда важна скорость и допустима потеря некоторых данных

### HTTP vs HTTP/2

#### HTTP/1.1
- **Текстовый протокол**: заголовки в текстовом формате
- **Последовательная обработка**: один запрос - один ответ
- **Блокирующие запросы**: head-of-line blocking
- **Избыточность заголовков**: повторная отправка одинаковых заголовков
- **Ограниченная оптимизация**: требуются дополнительные техники (спрайты, объединение файлов)

#### HTTP/2
- **Бинарный протокол**: более эффективная обработка
- **Мультиплексирование**: несколько запросов/ответов в одном соединении
- **Сжатие заголовков**: HPACK для уменьшения объема данных
- **Server Push**: сервер может отправлять ресурсы до запроса клиента
- **Приоритизация потоков**: оптимизация загрузки важных ресурсов
- **Одно TCP-соединение**: вместо множества в HTTP/1.1

#### HTTP/3
- **Использует QUIC вместо TCP**: построен на UDP
- **Улучшенная производительность**: особенно в нестабильных сетях
- **Быстрое установление соединения**: 0-RTT
- **Улучшенная безопасность**: шифрование по умолчанию
- **Независимые потоки**: нет блокировки при потере пакетов

### Уровни сетевой модели OSI и TCP/IP

#### Модель OSI (7 уровней)
1. **Физический**: передача битов по физическим каналам
2. **Канальный**: передача кадров между узлами
3. **Сетевой**: маршрутизация пакетов (IP)
4. **Транспортный**: надежная передача данных (TCP/UDP)
5. **Сеансовый**: управление сеансами связи
6. **Представления**: преобразование данных
7. **Прикладной**: интерфейс для приложений

#### Модель TCP/IP (4 уровня)
1. **Канальный**: соответствует физическому и канальному уровням OSI
2. **Интернет**: соответствует сетевому уровню OSI (IP)
3. **Транспортный**: соответствует транспортному уровню OSI (TCP/UDP)
4. **Прикладной**: соответствует сеансовому, представления и прикладному уровням OSI

#### HTTP в контексте моделей
- HTTP работает на прикладном уровне обеих моделей
- Использует TCP на транспортном уровне
- HTTP/3 использует QUIC (на базе UDP) на транспортном уровне

### REST и REST API подробнее

#### Ключевые характеристики REST
- **Архитектурный стиль**: не протокол или стандарт
- **Разделение клиента и сервера**: независимая эволюция
- **Stateless**: каждый запрос содержит всю необходимую информацию
- **Кэширование**: улучшает производительность и масштабируемость
- **Единый интерфейс**: упрощает архитектуру

#### Уровни зрелости REST (модель Ричардсона)
0. **Использование HTTP**: базовое использование HTTP
1. **Ресурсы**: использование URI для идентификации ресурсов
2. **HTTP методы**: правильное использование GET, POST, PUT, DELETE
3. **HATEOAS**: гипермедиа как двигатель состояния приложения

#### RESTful API Best Practices
- **Используйте существительные для ресурсов**: `/users` вместо `/getUsers`
- **Используйте вложенность для связанных ресурсов**: `/users/1/orders`
- **Версионирование API**: `/api/v1/users`
- **Пагинация для больших наборов данных**: `?page=2&limit=10`
- **Фильтрация, сортировка, поиск**: `?status=active&sort=name`
- **Правильные коды состояния HTTP**: 200, 201, 400, 401, 404, 500
- **Документация API**: OpenAPI/Swagger
- **Согласованный формат ответов**: JSON с единой структурой

#### Ограничения REST
- **Stateless**: может увеличить объем передаваемых данных
- **Единый интерфейс**: может снизить эффективность
- **Кэширование**: не всегда применимо для динамических данных
- **Альтернативы**: GraphQL, gRPC для специфических случаев
